version: '3.9'

services:
  # =======================
  # ðŸ–¥ FRONTEND
  # =======================
  frontend:
    build: ./frontend
    container_name: localrag_frontend
    ports:
      - "8501:8501"
    depends_on:
      - pdf_microservice
      - rag_microservice
      - chat_microservice
    environment:
      - PDF_SERVICE_URL=http://pdf_microservice:8001
      - RAG_SERVICE_URL=http://rag_microservice:8002
      - CHAT_SERVICE_URL=http://chat_microservice:8003
      - PUSHGATEWAY_URL=http://pushgateway:9091

  # =======================
  # ðŸ“„ PDF Service
  # =======================
  pdf_microservice:
    build: ./microservices/pdf_microservice
    container_name: pdf_microservice
    ports:
      - "8001:8001"

  # =======================
  # ðŸ§  RAG Service
  # =======================
  rag_microservice:
    build: ./microservices/rag_microservice
    container_name: rag_microservice
    ports:
      - "8002:8002"
    volumes:
      - ./ollama_data:/root/.ollama  # cache model data

  # =======================
  # ðŸ’¬ Chat Service
  # =======================
  chat_microservice:
    build: ./microservices/chat_microservice
    container_name: chat_microservice
    ports:
      - "8003:8003"

  # =======================
  # ðŸ“Š Monitoring
  # =======================
  pushgateway:
    image: prom/pushgateway
    container_name: pushgateway
    ports:
      - "9091:9091"

  prometheus:
    image: prom/prometheus
    container_name: prometheus
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
    depends_on:
      - pushgateway

  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
    depends_on:
      - prometheus
